<UserControl x:Class="Lacesong.WPF.Views.GameDetectionView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.openxmlformats.org/expression/blend/2008" 
             xmlns:vm="clr-namespace:Lacesong.WPF.ViewModels"
             mc:Ignorable="d" 
             d:DesignHeight="600" d:DesignWidth="800"
             d:DataContext="{d:DesignInstance vm:GameDetectionViewModel}">


    <Grid Margin="32">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Header -->
        <StackPanel Grid.Row="0" Margin="0,0,0,24">
            <TextBlock Text="Game Detection" FontSize="24" FontWeight="SemiBold" 
                       Foreground="{DynamicResource PrimaryTextBrush}" Margin="0,0,0,8"/>
            <TextBlock Text="Detect your Hollow Knight: Silksong installation automatically or browse manually." 
                       FontSize="14" Foreground="{DynamicResource SecondaryTextBrush}" TextWrapping="Wrap"/>
        </StackPanel>

        <!-- Main Content -->
        <Grid Grid.Row="1">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="20"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>

            <!-- Detection Panel -->
            <Border Grid.Column="0" Background="{DynamicResource CardBrush}" 
                    CornerRadius="6" Padding="24" Margin="0,0,8,0">
                <StackPanel>
                    <TextBlock Text="Automatic Detection" FontSize="18" FontWeight="SemiBold" 
                               Foreground="{DynamicResource PrimaryTextBrush}" Margin="0,0,0,16"/>
                    
                    <TextBlock Text="{Binding DetectionStatus}" FontSize="13" 
                               Foreground="{DynamicResource SecondaryTextBrush}" 
                               TextWrapping="Wrap" Margin="0,0,0,16"/>
                    
                    <Button Content="Detect Games" Command="{Binding DetectGamesCommand}" 
                            Style="{DynamicResource PrimaryButtonStyle}" 
                            IsEnabled="{Binding IsDetecting, Converter={StaticResource InverseBooleanConverter}}"
                            Margin="0,0,0,16"/>
                    
                    <TextBlock Text="This will scan your system for Hollow Knight: Silksong installations in:" 
                               FontSize="11" Foreground="{DynamicResource SecondaryTextBrush}" 
                               TextWrapping="Wrap" Margin="0,0,0,8"/>
                    
                    <TextBlock Text="• Steam Library" FontSize="11" 
                               Foreground="{DynamicResource SecondaryTextBrush}" Margin="16,0,0,4"/>
                    <TextBlock Text="• Epic Games Store" FontSize="11" 
                               Foreground="{DynamicResource SecondaryTextBrush}" Margin="16,0,0,4"/>
                    <TextBlock Text="• GOG Galaxy" FontSize="11" 
                               Foreground="{DynamicResource SecondaryTextBrush}" Margin="16,0,0,4"/>
                    <TextBlock Text="• Common installation paths" FontSize="11" 
                               Foreground="{DynamicResource SecondaryTextBrush}" Margin="16,0,0,0"/>
                </StackPanel>
            </Border>

            <!-- Manual Selection Panel -->
            <Border Grid.Column="2" Background="{DynamicResource CardBrush}" 
                    CornerRadius="6" Padding="24" Margin="8,0,0,0">
                <StackPanel>
                    <TextBlock Text="Manual Selection" FontSize="18" FontWeight="SemiBold" 
                               Foreground="{DynamicResource PrimaryTextBrush}" Margin="0,0,0,16"/>
                    
                    <TextBlock Text="If automatic detection doesn't find your game, you can browse for it manually." 
                               FontSize="13" Foreground="{DynamicResource SecondaryTextBrush}" 
                               TextWrapping="Wrap" Margin="0,0,0,16"/>
                    
                    <Button Content="Browse for Game" Command="{Binding BrowseForGameCommand}" 
                            Style="{DynamicResource SecondaryButtonStyle}" Margin="0,0,0,16"/>
                    
                    <TextBlock Text="Look for the folder containing:" FontSize="11" 
                               Foreground="{DynamicResource SecondaryTextBrush}" 
                               TextWrapping="Wrap" Margin="0,0,0,8"/>
                    
                    <TextBlock Text="Hollow Knight Silksong.exe" FontSize="11" 
                               Foreground="{DynamicResource SecondaryTextBrush}" Margin="16,0,0,0" 
                               FontFamily="Consolas"/>
                </StackPanel>
            </Border>
        </Grid>

        <!-- Detected Games -->
        <Border Grid.Row="2" Background="{DynamicResource CardBrush}" 
                CornerRadius="6" Padding="24" Margin="0,16,0,0" 
                Visibility="{Binding DetectedGames.Count, Converter={StaticResource CountToVisibilityConverter}}">
            <StackPanel>
                <TextBlock Text="Detected Games" FontSize="18" FontWeight="SemiBold" 
                           Foreground="{DynamicResource PrimaryTextBrush}" Margin="0,0,0,16"/>
                
                <ListView ItemsSource="{Binding DetectedGames}" SelectedItem="{Binding SelectedGame}"
                          Background="Transparent" BorderThickness="0">
                    <ListView.ItemTemplate>
                        <DataTemplate>
                            <Border Background="{DynamicResource ListItemBrush}" 
                                    CornerRadius="4" Padding="12" Margin="0,0,0,8">
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>
                                    
                                    <StackPanel Grid.Column="0">
                                        <TextBlock Text="{Binding Name}" FontSize="14" FontWeight="SemiBold" 
                                                   Foreground="{DynamicResource PrimaryTextBrush}"/>
                                        <TextBlock Text="{Binding InstallPath}" FontSize="11" 
                                                   Foreground="{DynamicResource SecondaryTextBrush}" 
                                                   TextWrapping="Wrap" Margin="0,4,0,0"/>
                                        <TextBlock Text="{Binding DetectedBy, StringFormat='Detected by: {0}'}" 
                                                   FontSize="11" Foreground="{DynamicResource SecondaryTextBrush}"/>
                                    </StackPanel>
                                    
                                    <Button Grid.Column="1" Content="Select" 
                                            Command="{Binding DataContext.SelectGameCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                            CommandParameter="{Binding}"
                                            Style="{DynamicResource AccentButtonStyle}"
                                            VerticalAlignment="Center"/>
                                </Grid>
                            </Border>
                        </DataTemplate>
                    </ListView.ItemTemplate>
                </ListView>
                
                <Button Content="Continue" Command="{Binding ProceedToNextCommand}" 
                        Style="{DynamicResource PrimaryButtonStyle}" 
                        HorizontalAlignment="Right" Margin="0,16,0,0"
                        IsEnabled="{Binding CanProceed}"/>
            </StackPanel>
        </Border>
    </Grid>
</UserControl>
